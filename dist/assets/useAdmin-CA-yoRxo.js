import{d,n as u,s as i}from"./index-CHW_jxOE.js";import{u as l,a as c}from"./useMutation-BSQQP79B.js";/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=d("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p=d("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=d("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),m={jokes:e=>["admin","jokes",e],categories:()=>["admin","categories"],users:e=>["admin","users",e],stats:()=>["admin","stats"]};function f(e){return l({queryKey:m.jokes(e),queryFn:async()=>{let t=i.from("jokes").select("*, category:categories(name, slug)",{count:"exact"});e.status!=="all"&&(t=t.eq("status",e.status)),e.category!=="all"&&(t=t.eq("category_id",parseInt(e.category))),e.search&&(t=t.ilike("content",`%${e.search}%`)),t=t.order(e.sort,{ascending:e.order==="asc"});const r=(e.page-1)*10,s=r+10-1;t=t.range(r,s);const{data:o,error:n,count:y}=await t;if(n)throw n;return{jokes:o||[],totalCount:y||0,totalPages:Math.ceil((y||0)/10)}},staleTime:1e3*60})}function _(){return l({queryKey:m.categories(),queryFn:async()=>{const{data:e,error:a}=await i.from("categories").select(`
          *,
          jokes(count)
        `).order("name");if(a)throw a;return(e||[]).map(r=>{var s,o;return{...r,jokes_count:((o=(s=r.jokes)==null?void 0:s[0])==null?void 0:o.count)||0}})},staleTime:1e3*60*30})}function w(e){return l({queryKey:m.users(e),queryFn:async()=>{let t=i.from("profiles").select("*",{count:"exact"});e.search&&(t=t.ilike("username",`%${e.search}%`)),e.role!=="all"&&(t=t.eq("is_admin",e.role==="admin")),t=t.order("created_at",{ascending:!1}).range((e.page-1)*10,e.page*10-1);const{data:r,error:s,count:o}=await t;if(s)throw s;return{users:(r||[]).map(y=>({...y,jokes_count:0})),totalCount:o||0,totalPages:Math.ceil((o||0)/10)}},staleTime:1e3*60})}function E(){const e=u();return c({mutationFn:async({jokeId:a,status:t})=>{const{error:r}=await i.from("jokes").update({status:t,updated_at:new Date().toISOString()}).eq("id",a);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","jokes"]})}})}function S(){const e=u();return c({mutationFn:async a=>{const{error:t}=await i.from("jokes").delete().eq("id",a);if(t)throw t},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","jokes"]})}})}function C(){const e=u();return c({mutationFn:async({jokeId:a,content:t,categoryId:r,status:s})=>{const{error:o}=await i.from("jokes").update({content:t,category_id:r,status:s,updated_at:new Date().toISOString()}).eq("id",a);if(o)throw o},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","jokes"]})}})}function j(){const e=u();return c({mutationFn:async({content:a,categoryId:t,status:r,authorId:s})=>{const o=a.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")+"-"+Date.now(),{error:n}=await i.from("jokes").insert({content:a,category_id:t,status:r,slug:o,author_id:s});if(n)throw n},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","jokes"]})}})}function P(){const e=u();return c({mutationFn:async({category:a,name:t,descriptionSeo:r})=>{const s=t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"").replace(/--+/g,"-"),o={name:t.trim(),slug:s,description_seo:r.trim()};if(a){const{error:n}=await i.from("categories").update(o).eq("id",a.id);if(n)throw n}else{const{error:n}=await i.from("categories").insert(o);if(n)throw n}},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","categories"]}),e.invalidateQueries({queryKey:["categories"]})}})}function K(){const e=u();return c({mutationFn:async a=>{const{error:t}=await i.from("categories").delete().eq("id",a);if(t)throw t},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","categories"]}),e.invalidateQueries({queryKey:["categories"]})}})}function M(){const e=u();return c({mutationFn:async({userId:a,isAdmin:t})=>{const{error:r}=await i.from("profiles").update({is_admin:!t}).eq("id",a);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["admin","users"]})}})}export{p as C,q as T,_ as a,E as b,S as c,C as d,j as e,k as f,P as g,K as h,w as i,M as j,f as u};
